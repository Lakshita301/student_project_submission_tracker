{% extends "base.html" %}
{% block title %}Student Dashboard{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2 class="fw-bold mb-4 text-center">Welcome, {{ session['name'] }}</h2>

  <div class="card p-4 mb-5 shadow-sm">
    <h5 class="mb-3 fw-semibold">Available Projects</h5>
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Project Title</th>
          <th>Faculty</th>
          <th>Deadline</th>
          <th>Your Grade</th> <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for p in projects %}
        <tr>
          <td>{{ p.title }}</td>
          <td>{{ p.faculty_name }}</td>
          <td>{{ p.deadline }}</td>
          <td>
            {% if p.student_grade is not none %}
                <span class="badge bg-success">Grade: {{ p.student_grade }}</span>
            {% else %}
                <span class="badge bg-secondary">Not Graded</span>
            {% endif %}
          </td>
          <td>
            <form action="{{ url_for('submit_project') }}" method="POST" enctype="multipart/form-data" class="d-flex gap-2">
              <input type="hidden" name="project_id" value="{{ p.project_id }}">
              <input type="file" name="file" class="form-control form-control-sm" required>
              <button class="btn btn-primary btn-sm">Submit</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card p-4 shadow-sm">
    <h5 class="mb-3 fw-semibold">Your Submissions</h5>
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th>Project</th>
          <th>Status</th>
          <th>Date</th>
          <th>Grade</th>
          <th>Comments</th>
          <th>File</th>
        </tr>
      </thead>
      <tbody>
        {% for s in submissions %}
        <tr>
          <td>{{ s.title }}</td>
          <td>{{ s.status }}</td>
          <td>{{ s.submission_date }}</td>
          <td>{{ s.grade if s.grade is not none else '-' }}</td>
          <td>{{ s.faculty_comments if s.faculty_comments else 'No comments yet' }}</td>
          <td>
            {% if s.file_link %}
              <a href="{{ url_for('uploaded_file', filename=s.file_link) }}" target="_blank" class="btn btn-sm btn-outline-secondary">View</a>
            {% else %}
              â€”
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}